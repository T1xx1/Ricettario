<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Ricettario</title>
   <link rel="stylesheet" href="index.css">
</head>

<body id="index">
   <header>
      <h1>Ricettario</h1>
      <nav>
         <input type="text" autofocus placeholder="Cerca una ricetta...">
         <select></select>
      </nav>
   </header>
   <main></main>
   <button id="add" title="Aggiungi">
      <img src="https://img.icons8.com/external-tanah-basah-glyph-tanah-basah/96/undefined/external-plus-user-interface-tanah-basah-glyph-tanah-basah-2.png">
   </button>
   <script>
      let html = document.querySelector('html');
      let input = document.querySelector('input');
      let main = document.querySelector('main');
      let select = document.querySelector('select');

      let search = (string = input.value, category = select.selectedOptions[0].innerHTML) => {
         let hide = button => {
            button.setAttribute('hidden', '');
         };
         let show = button => {
            button.removeAttribute('hidden');
         };

         category = category.toLowerCase();

         input.className = category;
         select.className = category;

         main.childNodes.forEach(button => {
            if (button.innerHTML.toLowerCase().includes(string.toLowerCase())) {
               if (category === 'none') {
                  show(button);
               } else {
                  if (category === button.className) {
                     show(button);
                  } else hide(button);
               }
            } else hide(button);
         });
      };
      let load = () => {
         preload.recipes.array.forEach(recipe => {
            let button = document.createElement('button');

            button.innerHTML = recipe.name;

            if (recipe.link) button.addEventListener('click', () => window.open(recipe.name));
            if (recipe.category) button.className = recipe.category;

            main.appendChild(button);
         });
      };

      add.addEventListener('click', () => preload.window('open-add'));
      html.addEventListener('keyup', event => {
         if (event.ctrlKey) switch (event.key) {
            case 'a':
               preload.window('open-add');

               break;
            case 'arrowup':
               window.scrollTo(0, 0);

               break;
            case '/':
               input.focus();

               break;
         }
      });
      input.addEventListener('keyup', () => search());
      select.addEventListener('click', () => search());

      preload.recipes.categories.forEach(category => select.innerHTML += `<option>${category}</option>`);

      load();
   </script>
</body>

</html>